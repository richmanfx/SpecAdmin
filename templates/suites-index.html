<!-- Шаблон хедера -->
{{ template "header.html" .}}

<span class="title">Сюиты группы </span><span id="name" class="title">{{ .groupName }}</span>
<p>
{{ range .suitesList }}
<div class="group_list">
    <table class="suite-table table table-bordered">
        <tr>
            <td class="suite-numbers">{{ .SerialNumber }}.</td>
            <td class="suite-name">
                <a href="#" onclick="anichange('#divId_{{ .Name }}'); return false" class="group_name">{{ .Name }}</a>
            </td>
            <td>{{ .Description }}</td>
            <td class="suite-icons">
                <a data-toggle="modal" data-target="#editSuite" href="#" title="Редактировать Сюиту" data-name="{{ .Name }}">
                    <img src="/images/icons/edit.png" alt="Rename" width="30" height="30">
                </a>

                <a data-toggle="modal" data-target="#delSuite" href="#" title="Удалить Сюиту" data-name="{{ .Name }}">
                    <img src="/images/icons/delete.png" alt="Delete" width="30" height="30">
                </a>

                <a data-toggle="modal" data-target="#addScript" href="#" title="Добавить Сценарий" data-name="{{ .Name }}">
                    <img src="/images/icons/add.png" alt="Add Script" width="30" height="30">
                </a>
            </td>
        </tr>
    </table>

    <div id="divId_{{ .Name }}" style="display: none">
        <table class="script-table">
            {{ range .Scripts }}
            <tr>
                <td class="script-numbers">{{ .SerialNumber }}.</td>
                <td class="script-name"><a href="#" onclick="anichange('#divId_{{ .Suite }}_{{ .SerialNumber }}'); return false">{{ .Name }}</a></td>
                <td>
                    <a data-toggle="modal" data-target="#editScript" href="#" title="Редактировать Сценарий"
                       data-name="{{ .Name }}" data-suite="{{ .Suite }}">
                        <img src="/images/icons/edit.png" alt="Rename" width="30" height="30">
                    </a>
                    <a data-toggle="modal" data-target="#delScript" href="#" title="Удалить Сценарий"
                       data-name="{{ .Name }}" data-suite="{{ .Suite }}">
                        <img src="/images/icons/delete.png" alt="Delete" width="30" height="30">
                    </a>
                    <a data-toggle="modal" data-target="#addStep" href="#" title="Добавить Шаг"
                       data-name="{{ .Name }}" data-suite="{{ .Suite }}">
                        <img src="/images/icons/add.png" alt="Add Step" width="30" height="30">
                    </a>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <div id="divId_{{ .Suite }}_{{ .SerialNumber }}" style="display: none" align="left">
                        <table class="step-table table">
                            <thead>
                            <tr>
                                <th class="steps-numbers">N&nbsp;</th>
                                <th class="center-align">Название Шага</th>
                                <th class="center-align">Описание Шага</th>
                                <th class="center-align">Ожидаемый результат</th>
                                <th class="center-align">Скриншот</th>
                                <th class="center-align">Действия</th>
                            </tr>
                            </thead>
                            <tbody>
                                {{ range .Steps }}
                                <tr>
                                    <td class="steps-numbers">{{ .SerialNumber }}.&nbsp;</td>
                                    <td class="steps-name">{{ .Name }}</td>
                                    <td class="steps-description">{{ .Description }}</td>
                                    <td class="steps-exp-result">{{ .ExpectedResult }}</td>
                                    <td class="steps-screen-shot">Здесь будет скриншот</td>
                                    <td class="steps-screen-shot">
                                        <a data-toggle="modal" data-target="#editStep" href="#" title="Редактировать Шаг"
                                           data-name="{{ .Name }}" data-script="{{ .ScriptsId }}">
                                            <img src="/images/icons/edit.png" alt="Rename" width="30" height="30">
                                        </a>
                                        <a data-toggle="modal" data-target="#delStep" href="#" title="Удалить Шаг"
                                           data-name="{{ .Name }}" data-script="{{ .ScriptsId }}">
                                            <img src="/images/icons/delete.png" alt="Delete" width="30" height="30">
                                        </a>
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </td>
            </tr>

            {{ end }}
        </table>
    </div>

</div>
{{ end }}

<!-- Скрипт для выпадающих списков -->
<script>
    function anichange (objName) {
        if ( $(objName).css('display') === 'none' ) {
            $(objName).animate({height: 'show'}, 400);
        } else {
            $(objName).animate({height: 'hide'}, 200);
        }
    }
    function anichange(a) {
        $(a).slideToggle(400);
    }
</script>

<!-- Подстановка имени сюиты в поле в модальном окне -->
<script>
    // Для кнопки "Редактировать"
    $('#editSuite').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);         // Кнопка, вызвавшая модальное окно
        var recipientName = button.data('name');     // Извлечь информацию из "data-name" у кнопки
        var modal = $(this);         // Обновить модальное окно
        modal.find('#id_suite').val(recipientName)      // Только в input со старым значением
    });

    // Для кнопки "Удалить"
    $('#delSuite').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);         // Кнопка, вызвавшая модальное окно
        var recipientName = button.data('name');     // Извлечь информацию из "data-name" у кнопки
        var modal = $(this);         // Обновить модальное окно
        modal.find('#id_suite').val(recipientName)
    });

    // Для кнопки "Добавить Сценарий"
    $('#addScript').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var recipientName = button.data('name');
        var modal = $(this);
        modal.find('#id_scripts_suite').val(recipientName)
    });
</script>

<!-- Подстановка имени Сценария и Сюиты в поля в модальном окне -->
<script>
    // Для кнопки "Редактировать"
    $('#editScript').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);         // Кнопка, вызвавшая модальное окно
        var recipientName = button.data('name');     // Извлечь информацию из "data-name" у кнопки
        var recipientSuite = button.data('suite');     // Извлечь информацию из "data-suite" у кнопки
        var modal = $(this);         // Обновить модальное окно
        modal.find('#id_script').val(recipientName);      // В input с именем сценария
        modal.find('#id_scripts_suite').val(recipientSuite)      // В input с именем сюиты
    });

    // Для кнопки "Удалить"
    $('#delScript').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);         // Кнопка, вызвавшая модальное окно
        var recipientName = button.data('name');     // Извлечь информацию из "data-name" у кнопки
        var recipientSuite = button.data('suite');     // Извлечь информацию из "data-suite" у кнопки
        var modal = $(this);         // Обновить модальное окно
        modal.find('#id_script').val(recipientName);
        modal.find('#id_scripts_suite').val(recipientSuite)      // В input с именем сюиты
    });

    // Для кнопки "Добавить Шаг"
    $('#addStep').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var recipientName = button.data('name');
        var recipientSuite = button.data('suite');
        var modal = $(this);
        modal.find('#id_steps_script').val(recipientName);
        modal.find('#id_scripts_suite').val(recipientSuite)
    });
</script>

<!-- Подстановка имени Шага, его Сценария и Сюиты в поля в модальном окне -->
<script>
    // Для кнопки "Редактировать"
    $('#editStep').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);         // Кнопка, вызвавшая модальное окно
        var recipientName = button.data('name');     // Извлечь информацию из "data-name" у кнопки
        var recipientScriptsId = button.data('script');     // Извлечь "ScriptsId"

        var stepsScriptName = "kuku1";
        var scripsSuiteName = "hehe2";

        // Получить имя Сценария по его ScriptsId и имя Сюиты, которой принадлежит Сценарий
        $.ajax({
            type: 'POST',
            url: '/spec-admin/get-steps-options',
            data: 'ScriptsId=' + recipientScriptsId,
            success: function(answerFromServer){
//                alert( "Прибыли данные: " + answer_from_server );
//                (stepsScriptName = $(answer_from_server).find("stepsScriptName").text);
                var parsedData = JSON.parse(answerFromServer);
                alert( parsedData );
//                alert( "stepsScriptName=" + stepsScriptName );

            },
            error: function(){
                alert("Ошибка при ответе на AJAX POST запрос");
            }
        });

        var modal = $(this);         // Обновить модальное окно
        modal.find('#id_step').val(recipientName);                      // В input с именем Шага
        modal.find('#id_steps_script').val(stepsScriptName);        // В input с именем Сценария
        modal.find('#id_scripts_suite').val(scripsSuiteName);       // В input с именем Сюиты
    });

    // Для кнопки "Удалить"
    $('#delStep').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);         // Кнопка, вызвавшая модальное окно
        var recipientName = button.data('name');     // Извлечь информацию из "data-name" у кнопки
        var recipientScriptsId = button.data('script');     // Извлечь "ScriptsId"
        var modal = $(this);         // Обновить модальное окно
        modal.find('#id_step').val(recipientName);
        modal.find('#id_steps_script').val(recipientScriptsId)      // В input с именем Сценария
    })
</script>

<!-- Шаблон футера -->
{{ template "footer.html" .}}
